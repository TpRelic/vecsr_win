time(0).
time(1).
time(2).
time(3).
time(4).
time(5).
time(6).
time(7).
time(8).
time(9).
time(10).
time(11).
time(12).
time(13).
time(14).
time(15).
time(16).
time(17).
time(18).
time(19).
time(20).
time(21).
time(22).
time(23).
time(24).
time(25).
type(character1, character).
characters(character1).
inside(character1, kitchen1, 0).
inside(character1, kitchen1, 0).
close(character1, kitchen1, 0).
inside(character1, kitchen1, 1).
close(character1, plate1, 1).
inside(character1, kitchen1, 2).
close(character1, plate1, 2).
inside(character1, kitchen1, 3).
close(character1, plate1, 3).
inside(character1, kitchen1, 4).
close(character1, fridge1, 4).
inside(character1, kitchen1, 5).
close(character1, fridge1, 5).
inside(character1, kitchen1, 6).
close(character1, fridge1, 6).
inside(character1, kitchen1, 7).
close(character1, fridge1, 7).
inside(character1, kitchen1, 8).
close(character1, fridge1, 8).
inside(character1, kitchen1, 9).
close(character1, fridge1, 9).
inside(character1, kitchen1, 10).
close(character1, fridge1, 10).
inside(character1, kitchen1, 11).
close(character1, fridge1, 11).
inside(character1, kitchen1, 12).
close(character1, fridge1, 12).
inside(character1, kitchen1, 13).
close(character1, fridge1, 13).
inside(character1, kitchen1, 14).
close(character1, fridge1, 14).
inside(character1, kitchen1, 15).
close(character1, fridge1, 15).
inside(character1, kitchen1, 16).
close(character1, fridge1, 16).
inside(character1, kitchen1, 17).
close(character1, fridge1, 17).
inside(character1, kitchen1, 18).
close(character1, fridge1, 18).
inside(character1, kitchen1, 19).
close(character1, fridge1, 19).
inside(character1, kitchen1, 20).
close(character1, fridge1, 20).
inside(character1, kitchen1, 21).
close(character1, fridge1, 21).
inside(character1, kitchen1, 22).
close(character1, fridge1, 22).
inside(character1, kitchen1, 23).
close(character1, fridge1, 23).
inside(character1, kitchen1, 24).
close(character1, fridge1, 24).
inside(character1, kitchen1, 25).
close(character1, fridge1, 25).
type(plate1, plate).
grabbable(plate1).
movable(plate1).
surfaces(plate1).
props(plate1).
recipient(plate1).
held(plate1, 3).
held(plate1, 4).
close(plate1, fridge1, 4).
close(plate1, character1, 4).
held(plate1, 5).
close(plate1, fridge1, 5).
close(plate1, character1, 5).
held(plate1, 6).
close(plate1, fridge1, 6).
close(plate1, character1, 6).
held(plate1, 7).
close(plate1, fridge1, 7).
close(plate1, character1, 7).
held(plate1, 8).
close(plate1, fridge1, 8).
close(plate1, character1, 8).
held(plate1, 9).
close(plate1, fridge1, 9).
close(plate1, character1, 9).
held(plate1, 10).
close(plate1, fridge1, 10).
close(plate1, character1, 10).
held(plate1, 11).
close(plate1, fridge1, 11).
close(plate1, character1, 11).
held(plate1, 12).
close(plate1, fridge1, 12).
close(plate1, character1, 12).
held(plate1, 13).
close(plate1, fridge1, 13).
close(plate1, character1, 13).
held(plate1, 14).
close(plate1, fridge1, 14).
close(plate1, character1, 14).
held(plate1, 15).
close(plate1, fridge1, 15).
close(plate1, character1, 15).
held(plate1, 16).
close(plate1, fridge1, 16).
close(plate1, character1, 16).
held(plate1, 17).
close(plate1, fridge1, 17).
close(plate1, character1, 17).
held(plate1, 18).
close(plate1, fridge1, 18).
close(plate1, character1, 18).
held(plate1, 19).
close(plate1, fridge1, 19).
close(plate1, character1, 19).
held(plate1, 20).
close(plate1, fridge1, 20).
close(plate1, character1, 20).
held(plate1, 21).
close(plate1, fridge1, 21).
close(plate1, character1, 21).
held(plate1, 22).
close(plate1, fridge1, 22).
close(plate1, character1, 22).
held(plate1, 23).
close(plate1, fridge1, 23).
close(plate1, character1, 23).
held(plate1, 24).
close(plate1, fridge1, 24).
close(plate1, character1, 24).
held(plate1, 25).
close(plate1, fridge1, 25).
close(plate1, character1, 25).
type(food_peanut_butter1, food_peanut_butter).
held(food_peanut_butter1, 15).
held(food_peanut_butter1, 16).
held(food_peanut_butter1, 17).
held(food_peanut_butter1, 18).
held(food_peanut_butter1, 19).
open(food_peanut_butter1, 20).
held(food_peanut_butter1, 20).
open(food_peanut_butter1, 21).
held(food_peanut_butter1, 21).
open(food_peanut_butter1, 22).
held(food_peanut_butter1, 22).
open(food_peanut_butter1, 23).
held(food_peanut_butter1, 23).
open(food_peanut_butter1, 24).
held(food_peanut_butter1, 24).
open(food_peanut_butter1, 25).
held(food_peanut_butter1, 25).
type(food_bread2, food_bread).
held(food_bread2, 10).
held(food_bread2, 11).
held(food_bread2, 12).
held(food_bread2, 13).
held(food_bread2, 14).
held(food_bread2, 15).
held(food_bread2, 16).
held(food_bread2, 17).
held(food_bread2, 18).
held(food_bread2, 19).
held(food_bread2, 20).
held(food_bread2, 21).
held(food_bread2, 22).
held(food_bread2, 23).
held(food_bread2, 24).
held(food_bread2, 25).
type(table1, table).
type(fridge1, fridge).
can_open(fridge1).
has_switch(fridge1).
containers(fridge1).
has_plug(fridge1).
appliances(fridge1).
open(fridge1, 5).
open(fridge1, 6).
open(fridge1, 7).
open(fridge1, 8).
open(fridge1, 9).
open(fridge1, 10).
open(fridge1, 11).
open(fridge1, 12).
open(fridge1, 13).
open(fridge1, 14).
open(fridge1, 15).
open(fridge1, 16).
closed(fridge1, 17).
closed(fridge1, 18).
closed(fridge1, 19).
closed(fridge1, 20).
closed(fridge1, 21).
closed(fridge1, 22).
closed(fridge1, 23).
closed(fridge1, 24).
closed(fridge1, 25).
type(knife1, knife).
held(knife1, 19).
held(knife1, 20).
held(knife1, 21).
held(knife1, 22).
held(knife1, 23).
held(knife1, 24).
held(knife1, 25).
type(food_bread1, food_bread).
held(food_bread1, 7).
held(food_bread1, 8).
held(food_bread1, 9).
held(food_bread1, 10).
held(food_bread1, 11).
held(food_bread1, 12).
held(food_bread1, 13).
held(food_bread1, 14).
held(food_bread1, 15).
held(food_bread1, 16).
held(food_bread1, 17).
held(food_bread1, 18).
held(food_bread1, 19).
held(food_bread1, 20).
held(food_bread1, 21).
held(food_bread1, 22).
held(food_bread1, 23).
held(food_bread1, 24).
held(food_bread1, 25).
type(kitchen1, kitchen).
rooms(kitchen1).
% General Rules
time(0).
:- held(X, T), held(Y, T), held(Z, T), X \= Y, X \= Z, Y \= Z.
-rooms(X) :- not rooms(X).
#abducible open.
#abducible closed.
#abducible off.
#abducible on.
open(X, _) :- rooms(X).

reachable(X, T) :- not -reachable(X, T).
-reachable(X, T) :- inside(X, Obj1, T), closed(Obj1, T).
%inherited_inside(X, Y, T) :- inside(X, Y, T).
%inherited_inside(X, Y, T) :- inside(X, Z, T), inherited_inside(Z, Y, T).

close(X, Y, T) :- close(Y, X, T).
close(character1, X, T) :- held(X, T).
has_free_hand(T) :- not holding_two_items(T).
holding_two_items(T) :- held(X, T), held(Y, T), X \= Y.

needs_cooking(X) :- food(X), not eatable(X), not dish(X).
eatable(X) :- fruit(X).
eatable(X) :- vegetable(X).
fruit(X) :- type(X, bananas).
vegetable(X) :- type(X, bellpepper).
eatable(X) :- type(X, chips).
eatable(X) :- type(X, crackers).

exists(X) :- type(X, _).

%% Execute with --no_nmr
action_possible(Action, Item, T) :-
    time(T),
    action(Action),
    action_valid(Action, Item,T).
%    not other_action(Action, Item, T).
%other_action(Action, Item, T) :-
%    time(T),
%    action(Action),
%    action(B),
%    Action \= B,
%    Item \= Item2,
%    action_done(B, Item2, T).

action_valid(walk,X,T) :- X \= character1, rooms(X), not inside(character1, X, T), not action_invalid(walk, X, T).
action_valid(walk,X,T) :- X \= character1, -rooms(X), not sitting(character1, T), not held(X, T), reachable(X, T),
                        not close(character1, X, T),
                        inside(character1, Room, T), inside(X, Room, T),
                        not action_invalid(walk, X, T).
action_valid(grab,X,T) :- grabbable(X), close(character1, X, T), reachable(X, T), has_free_hand(T), not action_invalid(grab, X, T).
action_valid(put,X,T) :- held(_, T), close(character1, X, T), not action_invalid(put, X, T).
action_valid(find, X, T) :- not action_invalid(find, X, T).
action_valid(drink, X, T) :- recipient(X), drinkable(Y), inside(Y, X, T), close(character1, X, T), not action_invalid(drink, X, T).
action_valid(eat, X, T) :- recipient(Y), eatable(X), inside(X, Y, T), close(character1, X, T), not action_invalid(eat, X, T).
action_valid(eat, X, T) :- recipient(Y), eatable(X), ontopof(X, Y, T), close(character1, X, T), not action_invalid(eat, X, T).
action_valid(switch_on, X, T) :- has_switch(X), off(X, T), close(character1, X, T), not action_invalid(switch_on, X, T).
action_valid(switch_off, X, T) :- has_switch(X), on(X, T), close(character1, X, T), not action_invalid(switch_off, X, T).
action_valid(use, X, T) :- has_switch(X), on(X, T), close(character1, X, T), not action_invalid(use, X, T).
action_valid(use, X, T) :- not has_switch(X), close(character1, X, T), not action_invalid(use, X, T).
action_valid(sit, X, T) :- not sitting(character1, T), not laying(character1, T), close(character1, X, T), sittable(X), not action_invalid(sit, X, T).
action_valid(lie, X, T) :- not sitting(character1, T), not laying(character1, T), close(character1, X, T), lieable(X), not action_invalid(lie, X, T).
action_valid(open, X, T) :- can_open(X), closed(X, T), close(character1, X, T), reachable(X, T), not action_invalid(open, X, T).
action_valid(close, X, T) :- can_open(X), open(X, T), close(character1, X, T), reachable(X, T), not action_invalid(close, X, T).
action_valid(move, X, T) :- movable(X), close(character1, X, T), reachable(X, T), not action_invalid(move, X, T).
action_valid(turn_to, X, T) :- reachable(X, T), not action_invalid(turn_to, X, T).
action_valid(point, X, T) :- not action_invalid(point, X, T).


action_invalid(find, X, T) :- T2 .<. T, action_done(walk, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(grab, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(put, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(drink, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(eat, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(switch_on, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(switch_off, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(use, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(sit, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(lie, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(open, X, T2).
action_invalid(find, X, T) :- T2 .<. T, action_done(close, X, T2).
action_invalid(_, X, _) :- not exists(X).

action(walk).
action(grab).
action(put).
action(find).
action(drink).
action(eat).
action(switch_on).
action(switch_off).
action(use).
action(sit).
action(lie).
action(open).
action(close).
action(move).
action(turn_to).
action(point).

#show action_done/3, not action_valid/3.

action_done(walk,kitchen1,-1).
action_done(walk,plate1,0).
action_done(find,plate1,1).
action_done(grab,plate1,2).
action_done(walk,fridge1,3).
action_done(open,fridge1,4).
action_done(find,food_bread1,5).
action_done(grab,food_bread1,6).
action_done(putback,food_bread1,7).
action_done(find,food_bread2,8).
action_done(grab,food_bread2,9).
action_done(putback,food_bread2,10).
action_done(find,table1,11).
action_done(putback,plate1,12).
action_done(find,food_peanut_butter1,13).
action_done(grab,food_peanut_butter1,14).
action_done(putback,food_peanut_butter1,15).
action_done(close,fridge1,16).
action_done(find,knife1,17).
action_done(grab,knife1,18).
action_done(open,food_peanut_butter1,19).
action_done(grab,food_peanut_butter1,20).
action_done(putback,food_peanut_butter1,21).
action_done(spread,food_peanut_butter1,22).
action_done(spread,food_peanut_butter1,23).

?- action_possible(putobjback,knife1,24).